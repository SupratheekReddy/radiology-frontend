<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rad AI | Intelligent Radiology Platform</title>

  <!-- Fonts: Plus Jakarta Sans -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Socket.io -->
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<!-- ============================================================
     VIEW 1 — LANDING PAGE (100% ORIGINAL)
=============================================================== -->
<div id="landingPage">

  <!-- NAVBAR -->
  <nav class="navbar">
    <div class="container nav-container">
      <div class="brand">
        <div class="logo-box"><i class="fa-solid fa-layer-group"></i></div>
        <span>Rad AI</span>
      </div>
      <ul class="nav-links">
        <li><a href="#features">Platform Features</a></li>
        <li><a href="#impact">Clinical Impact</a></li>
        <li><a href="#workflow">Workflow</a></li>
        <li><a href="#about">About Us</a></li>
      </ul>
      <button class="btn-primary-outline" onclick="navigateToLogin()">Login</button>
    </div>
  </nav>

  <!-- HERO SECTION -->
  <section class="hero">
    <div class="container hero-content">
      <div class="hero-text fade-in-up">
        <div class="badge-pill"><i class="fa-solid fa-sparkles"></i> Next-Gen Radiology</div>
        <h1>
          Accelerating Diagnosis <br>
          with <span class="highlight">Artificial Intelligence.</span>
        </h1>
        <p>
          Seamlessly connecting Patients, Doctors, and Radiologists in one
          unified, intelligent workflow.
        </p>
        <div class="hero-actions">
          <button class="btn-primary" onclick="navigateToLogin()">Get Started</button>
          <button class="btn-text"><i class="fa-solid fa-play-circle"></i> See How It Works</button>
        </div>
      </div>

      <!-- HERO RIGHT SIDE -->
      <div class="hero-image fade-in-up delay-100">
        <div class="glass-mockup">
          <div class="scan-animation">
            <i class="fa-solid fa-rib-cage"></i>
            <div class="scan-beam"></div>
          </div>
          <div class="floating-card c1">
            <i class="fa-solid fa-check-circle"></i> No Anomalies
          </div>
          <div class="floating-card c2">
            <i class="fa-solid fa-user-doctor"></i> Dr. Verify
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- FEATURES -->
  <section id="features" class="section">
    <div class="container">
      <div class="section-title">
        <h2>Platform Features</h2>
        <p>Built for speed, accuracy, and ease of use.</p>
      </div>
      <div class="grid-3">
        <div class="feature-card">
          <div class="icon-sq blue"><i class="fa-solid fa-brain"></i></div>
          <h3>AI Analysis</h3>
          <p>Automated pre-screening of X-Rays and MRIs to flag critical conditions instantly.</p>
        </div>
        <div class="feature-card">
          <div class="icon-sq purple"><i class="fa-solid fa-share-nodes"></i></div>
          <h3>Unified Workflow</h3>
          <p>Real-time data sync between technicians, radiologists, and consulting doctors.</p>
        </div>
        <div class="feature-card">
          <div class="icon-sq green"><i class="fa-solid fa-shield-halved"></i></div>
          <h3>Secure Data</h3>
          <p>End-to-end encryption compliant with global healthcare standards.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- CLINICAL IMPACT (RESTORED) -->
  <section id="impact" class="section bg-soft">
    <div class="container split-view">
      <div class="split-text">
        <h2>Clinical Impact</h2>
        <ul class="impact-list">
          <li><span>40%</span> Faster Diagnosis Time</li>
          <li><span>99%</span> Accuracy in Fracture Detection</li>
          <li><span>24/7</span> Automated Triage System</li>
        </ul>
      </div>
      <div class="split-img">
        <div class="impact-card">
          <h3>Patient Outcomes</h3>
          <div class="chart-line"></div>
          <div class="chart-line w-80"></div>
          <div class="chart-line w-60"></div>
        </div>
      </div>
    </div>
  </section>

  <footer class="footer" id="about">
    <div class="container">
      <div class="footer-brand">
        <span>Rad AI</span>
        <p>&copy; 2024 Intelligent Medical Systems</p>
      </div>
    </div>
  </footer>
</div>

<!-- ==============================================
      VIEW 2 — LOGIN PAGE (100% ORIGINAL)
================================================== -->
<div id="loginPage" style="display:none;">
  <div class="login-container">
    <!-- LEFT SIDE -->
    <div class="login-left">
      <button class="back-link" onclick="navigateToHome()">
        <i class="fa-solid fa-arrow-left"></i> Back to Home
      </button>
      <div class="login-brand">
        <h1>Rad AI</h1>
        <p>Secure Medical Portal</p>
      </div>
      <div class="login-art">
        <div class="art-blob"></div>
        <img src="https://img.freepik.com/free-vector/doctor-concept-illustration_114360-1269.jpg" class="art-img">
      </div>
    </div>

    <!-- RIGHT SIDE -->
    <div class="login-right">
      <div class="login-box">
        <h2>Select Portal</h2>
        <p class="sub-head">Who is logging in today?</p>
        <!-- ROLE SELECTOR -->
        <div class="role-grid" id="roleToggle">
          <button class="role-card active" data-role="patient">
            <i class="fa-solid fa-user-injured"></i><span>Patient</span>
          </button>
          <button class="role-card" data-role="admin">
            <i class="fa-solid fa-user-shield"></i><span>Admin</span>
          </button>
          <button class="role-card" data-role="doctor">
            <i class="fa-solid fa-user-doctor"></i><span>Doctor</span>
          </button>
          <button class="role-card" data-role="radiologist">
            <i class="fa-solid fa-x-ray"></i><span>Radiologist</span>
          </button>
          <button class="role-card" data-role="technician">
            <i class="fa-solid fa-microscope"></i><span>Tech</span>
          </button>
        </div>

        <!-- LOGIN FORM -->
        <div class="form-wrapper">
          <div class="input-group">
            <label>ID / Username</label>
            <input type="text" id="loginId" placeholder="Enter your ID">
          </div>
          <div class="input-group">
            <label>Password</label>
            <input type="password" id="loginPassword" placeholder="••••••••">
          </div>
          <button class="btn-primary full-width" id="loginBtn">Access Dashboard</button>
          <div class="error-msg" id="loginError">Invalid Credentials</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ===============================
     VIEW 3: APP LAYOUT (Dashboard)
================================ -->
<div id="appLayout" style="display:none;">
  <aside class="sidebar">
    <div class="sidebar-brand">
      <i class="fa-solid fa-layer-group"></i>
      <span>Rad AI</span>
    </div>

    <!-- Dynamic Role‑Based Sidebar -->
    <nav id="dynamicNav" class="sidebar-nav"></nav>

    <div class="user-panel">
      <!-- <img src="" id="userAvatar"> -->
      <div class="user-info">
        <strong id="displayUsername">User</strong>
        <small id="displayRole">Role</small>
      </div>
      <button onclick="logout()" class="logout-icon">
        <i class="fa-solid fa-power-off"></i>
      </button>
    </div>
  </aside>

  <main class="main-content">
    <header class="top-header">
      <h2 id="pageTitle">Dashboard</h2>
      <div class="status-indicator">
        <div class="dot"></div> System Live
      </div>
    </header>

    <div class="content-body" id="mainContainer">

      <!-- ============================
           ADMIN PANEL (FULL ORIGINAL FORMS RESTORED)
      ============================= -->
      <div id="adminSections" class="view-group">
        <!-- TOP STATS -->
        <div class="stats-row">
          <div class="stat-box">
            <i class="fa-solid fa-user-doctor purple"></i>
            <div><h4>Doctors</h4><span>Active</span></div>
          </div>
          <div class="stat-box">
            <i class="fa-solid fa-bed-pulse blue"></i>
            <div><h4>Patients</h4><span>Monitoring</span></div>
          </div>
          <div class="stat-box">
            <i class="fa-solid fa-check-circle green"></i>
            <div><h4>System</h4><span>Optimal</span></div>
          </div>
        </div>

        <!-- ADMIN FORMS GRID -->
        <div class="form-grid-layout">
          <!-- ADMIN: ADD DOCTOR -->
          <div class="card section" id="adminAddDoctor">
            <h3>Add Doctor</h3>
            <input id="docName" class="inp" placeholder="Name">
            <input id="docEmail" class="inp" placeholder="Email">
            <input id="docUser" class="inp" placeholder="Username">
            <input id="docPass" class="inp" type="password" placeholder="Password">
            <button class="btn-primary mt-2" onclick="addDoctor()">Save</button>
            <span id="docSuccess" class="success-msg">Saved!</span>
          </div>

          <!-- ADMIN: ADD TECH -->
          <div class="card section" id="adminAddTech">
            <h3>Add Technician</h3>
            <input id="techName" class="inp" placeholder="Name">
            <input id="techEmail" class="inp" placeholder="Email">
            <input id="techUser" class="inp" placeholder="Username">
            <input id="techPass" class="inp" type="password" placeholder="Password">
            <button class="btn-primary mt-2" onclick="addTechnician()">Save</button>
            <span id="techSuccess" class="success-msg">Saved!</span>
          </div>

          <!-- ADMIN: ADD RADIOLOGIST -->
          <div class="card section" id="adminAddRadiologist">
            <h3>Add Radiologist</h3>
            <input id="radioName" class="inp" placeholder="Name">
            <input id="radioEmail" class="inp" placeholder="Email">
            <input id="radioUser" class="inp" placeholder="Username">
            <input id="radioPass" class="inp" type="password" placeholder="Password">
            <button class="btn-primary mt-2" onclick="addRadiologist()">Save</button>
            <span id="radioSuccess" class="success-msg">Saved!</span>
          </div>

          <!-- ADMIN: ADD PATIENT -->
          <div class="card section" id="adminAddPatient">
            <h3>Add Patient</h3>
            <input id="patName" class="inp" placeholder="Name">
            <input id="patEmail" class="inp" placeholder="Email">
            <input id="patUser" class="inp" placeholder="Username">
            <input id="patPass" class="inp" type="password" placeholder="Password">
            <select id="patPriority" class="inp">
              <option value="Critical">Critical</option>
              <option value="Medium">Medium</option>
              <option value="Safe">Safe</option>
            </select>
            <button class="btn-primary mt-2" onclick="addPatient()">Save</button>
            <span id="patSuccess" class="success-msg">Saved!</span>
          </div>
        </div>

        <!-- SCHEDULE CASE -->
        <div class="card section mt-4" id="adminSchedule">
          <h3>Schedule Scan</h3>
          <div class="grid-3">
            <select id="casePatient" class="inp"></select>
            <select id="caseDoctor" class="inp"></select>
            <input id="caseDate" class="inp" type="date">
            <select id="caseSlot" class="inp">
              <option>09:00 - 10:00</option>
              <option>10:00 - 11:00</option>
              <option>11:00 - 12:00</option>
              <option>14:00 - 15:00</option>
            </select>
            <select id="caseScanType" class="inp">
              <option value="MRI">MRI</option>
              <option value="CT">CT Scan</option>
              <option value="X-Ray">X-Ray</option>
            </select>
            <select id="casePriority" class="inp">
              <option value="Critical">Critical</option>
              <option value="Medium">Medium</option>
              <option value="Safe">Safe</option>
            </select>
            <input id="caseRefDoc" class="inp full" placeholder="Referring Doctor">
            <textarea id="caseSymptoms" class="inp full" placeholder="Symptoms"></textarea>
          </div>
          <button class="btn-primary mt-2" onclick="scheduleCase()">Schedule</button>
          <span id="caseSuccess" class="success-msg">Done!</span>
        </div>

        <!-- ADMIN CASES LIST -->
        <div class="section mt-4" id="adminCases">
          <div class="cards-list" id="adminCasesList"></div>
        </div>
      </div> <!-- END ADMIN SECTIONS -->

      <!-- === DOCTOR VIEW (UPDATED: Added 'Create Case' Button & Timeline Sidebar) === -->
      <div id="doctorCasesView" class="view-group" style="display:none">
        <div style="text-align:right; margin-bottom:15px;">
            <button class="btn-primary" onclick="openCreateCase()">+ Create New Case</button>
        </div>
        <div class="doctor-layout-split">
            <div class="cards-list" id="doctorCasesList" style="flex:2">Doctor Cases Loading...</div>
            <div id="timelineSidebar" class="timeline-panel" style="display:none;">
                <div class="timeline-header">
                    <h4>Patient History</h4>
                    <button onclick="closeTimeline()" class="btn-text"><i class="fa-solid fa-times"></i></button>
                </div>
                <div id="timelineContent"></div>
            </div>
        </div>
      </div>

      <!-- === PATIENT VIEW === -->
      <div id="patientCasesView" class="view-group" style="display:none">
        <div class="cards-list" id="patientCasesList">Patient Cases Loading...</div>
      </div>

      <!-- === TECH VIEW === -->
      <div id="techCasesView" class="view-group" style="display:none">
        <div class="cards-list" id="techCasesList">Tech Cases Loading...</div>
      </div>

      <!-- === RADIOLOGIST VIEW === -->
      <div id="radioCasesView" class="view-group" style="display:none">
        <div class="cards-list" id="radioCasesList">Radiologist Cases Loading...</div>
      </div>

    </div> <!-- END content-body -->
  </main>
</div> <!-- END appLayout -->

<!-- ==============================================
     VIEW 4: FULL FOCUS CASE VIEW (✅ NEW ADDITION)
================================================== -->
<div id="fullCaseView" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#f8fafc; z-index:2000; overflow-y:auto;">
  
  <!-- Focus Header -->
  <div style="background:white; padding:15px 30px; border-bottom:1px solid #ddd; display:flex; justify-content:space-between; align-items:center; position:sticky; top:0; z-index:10; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
    <div style="display:flex; align-items:center; gap:15px;">
        <div style="background:#e0e7ff; padding:10px; border-radius:50%; color:var(--primary);"><i class="fa-solid fa-hospital-user fa-xl"></i></div>
        <div>
            <h2 id="focusPatientName" style="margin:0; font-size:1.4rem;">Patient Name</h2>
            <span id="focusCaseId" class="badge" style="font-size:0.8rem;">CASE-ID</span>
        </div>
    </div>
    <button class="btn-primary-outline" onclick="closeCaseView()">
        <i class="fa-solid fa-arrow-left"></i> Back to Dashboard
    </button>
  </div>

  <!-- Focus Content Grid -->
  <div class="container" style="padding:30px 0; display:grid; grid-template-columns: 1.2fr 0.8fr; gap:30px;">
    
    <!-- LEFT COLUMN: SCAN & AI -->
    <div style="display:flex; flex-direction:column; gap:20px;">
        <!-- Image Section -->
        <div style="background:white; padding:20px; border-radius:16px; border:1px solid #eee; box-shadow: var(--shadow);">
            <h3 style="margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:10px;"><i class="fa-solid fa-x-ray"></i> Medical Scan</h3>
            <img id="focusImage" src="" style="width:100%; max-height:500px; object-fit:contain; background:black; border-radius:8px;">
        </div>
        
        <!-- AI Results Section -->
        <div style="background:white; padding:20px; border-radius:16px; border:1px solid #eee; box-shadow: var(--shadow);">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h3><i class="fa-solid fa-wand-magic-sparkles" style="color:var(--primary);"></i> AI Analysis</h3>
                <button class="btn-primary" id="btnRunAI" onclick="runFocusAI()">Run Advanced Analysis</button>
            </div>

            <!-- Detailed AI Output Container -->
            <div id="aiResults" style="display:none;">
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:15px;">
                    <div style="background:#f0f9ff; padding:10px; border-radius:8px;"><strong>Diagnosis:</strong> <span id="aiDiagnosis"></span></div>
                    <div style="background:#f0f9ff; padding:10px; border-radius:8px;"><strong>Confidence:</strong> <span id="aiConfidence"></span></div>
                </div>
                
                <div style="background:#fff7ed; padding:15px; border-radius:8px; border-left:4px solid #f97316; margin-bottom:15px;">
                    <strong style="color:#c2410c;">Detailed Findings:</strong>
                    <p id="aiFindings" style="margin-top:5px; line-height:1.6; color:#431407;"></p>
                </div>

                <div style="background:#f0fdf4; padding:15px; border-radius:8px; border-left:4px solid #16a34a;">
                    <strong style="color:#15803d;">Recommended Treatment / Next Steps:</strong>
                    <p id="aiTreatment" style="margin-top:5px; font-weight:bold; color:#14532d;"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- RIGHT COLUMN: WORKSPACE -->
    <div style="display:flex; flex-direction:column; gap:20px;">
        
        <!-- Radiologist Reporting Tool -->
        <div style="background:white; padding:20px; border-radius:16px; border:1px solid #eee; box-shadow: var(--shadow);">
            <h3 style="margin-bottom:10px;"><i class="fa-solid fa-file-medical"></i> Radiologist Report</h3>
            <p style="font-size:0.85rem; color:#666; margin-bottom:10px;">Write your official findings and prescription for the doctor.</p>
            <textarea id="focusNotes" class="inp" rows="12" style="font-family:monospace; font-size:0.9rem;" placeholder="1. Findings...&#10;2. Impression...&#10;3. Recommendation..."></textarea>
            <div style="text-align:right; margin-top:10px;">
                <button class="btn-primary" onclick="saveFocusNotes()">
                    <i class="fa-solid fa-floppy-disk"></i> Save & Sign Report
                </button>
            </div>
        </div>

        <!-- AI Assistant Chat -->
        <div class="chat-container" style="height:400px; background:white; padding:0; border:1px solid #eee; box-shadow: var(--shadow); border-radius:16px; overflow:hidden;">
            <div style="padding:15px; border-bottom:1px solid #eee; background:#f8fafc; font-weight:bold; color:var(--primary);">
                <i class="fa-solid fa-robot"></i> AI Assistant
            </div>
            <div id="focusChatHistory" style="flex:1; overflow-y:auto; padding:15px; display:flex; flex-direction:column; gap:10px;"></div>
            <div style="padding:10px; border-top:1px solid #eee; display:flex; background:white; gap:5px;">
                <input type="text" id="focusChatInput" class="inp" style="margin:0;" placeholder="Ask about the scan...">
                <button class="btn-text" style="background:var(--primary); color:white; padding:0 20px; border-radius:8px;" onclick="sendFocusChat()">Send</button>
            </div>
        </div>

    </div>
  </div>
</div>

<!-- ==============================================
     NEW: HIDDEN MODALS (FOR FEATURES)
     (Appended at the end, so they don't break layout)
================================================== -->

<!-- CREATE CASE MODAL -->
<div id="createCaseModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
        <h3>New Radiology Case</h3>
        <button onclick="closeModal('createCaseModal')" class="btn-text">x</button>
    </div>
    <div class="modal-body">
        <label>Select Patient</label>
        <select id="casePatientSelect" class="inp"></select>
        <label>Scan Type</label>
        <select id="caseScanType" class="inp">
            <option>X-Ray</option><option>MRI</option><option>CT Scan</option>
        </select>
        <label>Symptoms / Notes</label>
        <textarea id="caseSymptoms" class="inp" placeholder="e.g. Pain in left wrist..."></textarea>
    </div>
    <div class="modal-footer">
        <button class="btn-primary" onclick="submitCreateCase()">Create Case</button>
    </div>
  </div>
</div>

<!-- PRESCRIPTION MODAL -->
<div id="prescribeModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
        <h3>Write Prescription</h3>
        <button onclick="closeModal('prescribeModal')" class="btn-text">x</button>
    </div>
    <div class="modal-body">
        <textarea id="prescribeText" class="inp" rows="5" placeholder="Enter medication, dosage, and instructions..."></textarea>
    </div>
    <div class="modal-footer">
        <button class="btn-primary" onclick="submitPrescription()">Submit & Email Patient</button>
    </div>
  </div>
</div>

<script src="script.js"></script>
</body>
</html>